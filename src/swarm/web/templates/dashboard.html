{% extends "base.html" %}
{% block title %}Swarm's Bee Hive — Dashboard{% endblock %}

{% block body %}
<div id="test-mode-banner" style="display:none; background:#f59e0b; color:#000; text-align:center; padding:6px 12px; font-weight:bold; font-size:14px;">
    TEST MODE — Supervised orchestration testing active
    <span id="test-report-link" style="display:none; margin-left:12px;"></span>
</div>
<div id="update-banner" style="display:none; background:#362415; border-bottom:2px solid var(--leaf); padding:8px 16px; font-size:13px; color:var(--text); text-align:center;">
    <span id="update-banner-text"></span>
    <button data-action="installUpdate" style="margin-left:12px; padding:2px 10px; background:var(--leaf); color:#000; border:none; border-radius:4px; cursor:pointer; font-size:12px; font-weight:600;">Update &amp; Restart</button>
    <button data-action="hideUpdateBanner" style="margin-left:6px; padding:2px 10px; background:transparent; color:var(--muted); border:1px solid var(--muted); border-radius:4px; cursor:pointer; font-size:12px;">Dismiss</button>
</div>
<header>
    <h1><img src="/static/bees/happy.svg" alt="" class="header-icon"><span class="ws-indicator" id="ws-dot"></span> Swarm's Bee Hive <span id="header-clock" class="header-clock"></span></h1>
    <div class="flex-center gap-md">
        <div class="status" id="status-bar">
            {{ worker_count }} workers
        </div>
        <span id="queen-queue-badge" class="notification-badge bg-lavender" style="display:none" title="Queen calls: running/total"></span>
        <button class="btn {{ 'btn-active' if drones_enabled else 'btn-secondary' }}" id="drones-btn"
                data-action="toggleDrones">
            Drones: {{ 'ON' if drones_enabled else 'OFF' }}
        </button>
        <button class="btn {{ 'btn-active' if tunnel.running else 'btn-secondary' }} header-hide-mobile" id="tunnel-btn"
                data-action="tunnelAction">
            Tunnel{{ ': ON' if tunnel.running else '' }}
        </button>
        <a href="/config" class="btn btn-secondary no-underline header-hide-mobile">Config</a>
        <!-- Attach button removed: PTY model has no full-session view -->
        <button class="btn btn-queen header-hide-mobile" data-action="askQueen" id="queen-btn" title="Ask Queen to analyze the hive">Ask Queen</button>
        <button class="btn btn-secondary btn-notif header-hide-mobile" id="notif-perm-btn" data-action="requestNotifPermission" title="Enable buzz alerts">&#x1f514;</button>
        <button class="btn btn-danger header-hide-mobile" data-action="killSession" title="Shutdown — kill all workers">Shutdown</button>
        <!-- Mobile overflow menu -->
        <div class="mobile-overflow">
            <button class="mobile-overflow-btn" data-action="toggleMobileMenu" aria-label="More actions">&#x2630;</button>
            <div class="mobile-overflow-menu" id="mobile-overflow-menu">
                <button class="btn btn-secondary" data-action="tunnelAction" data-close-menu="1">Tunnel</button>
                <a href="/config" class="btn btn-secondary no-underline">Config</a>
                <!-- Attach button removed: PTY model has no full-session view -->
                <button class="btn btn-queen" data-action="askQueen" data-close-menu="1">Ask Queen</button>
                <button class="btn btn-danger" data-action="killSession" data-close-menu="1">Shutdown</button>
            </div>
        </div>
    </div>
</header>

<div class="dashboard">
    <!-- Git conflict banner -->
    <div id="git-conflict-banner" style="display:none;background:var(--amber);color:var(--hive-bg);padding:0.5rem 1rem;text-align:center;font-size:0.85rem;">
        <strong>File Conflicts:</strong> <span id="conflict-details"></span>
        <button class="btn btn-sm" style="margin-left:0.75rem;font-size:0.7rem;" data-action="hideConflictBanner">Dismiss</button>
    </div>

    <!-- Queen notification banners (non-blocking, replaces modal popups) -->
    <div id="queen-notifications" aria-live="polite" role="status"></div>

    <!-- Worker sidebar -->
    <div class="panel worker-list">
        <div class="panel-header">Workers</div>
        <div class="panel-body" id="worker-list">
            {% include "partials/worker_list.html" %}
        </div>
        <div class="action-bar">
            <button class="btn btn-secondary" data-action="showLaunch" style="width:100%">Launch</button>
        </div>
    </div>

    <!-- Detail area -->
    <div class="detail-area">
        <div class="panel">
            <div class="panel-header" id="detail-title">Select a worker</div>
            <div class="panel-body" id="detail-body">
                <p class="text-muted modal-padding">Click a worker to see details</p>
            </div>
            <!-- Mobile send bar (touch devices only) -->
            <div class="mobile-send-bar" id="mobile-send-bar" style="display:none">
                <input type="text" id="mobile-send-input" placeholder="Type or dictate..."
                       enterkeyhint="send"
                       data-enter-action="mobileSend">
                <button class="btn btn-sm" data-action="mobileSend">Send</button>
            </div>
            <!-- Action bar (shown when a worker is selected) -->
            <div class="action-bar" id="terminal-actions" style="display:none">
                {% for btn in action_buttons %}
                <button type="button"
                        class="btn btn-{{ btn.style }}{% if not btn.show_mobile %} hide-mobile{% endif %}{% if not btn.show_desktop %} hide-desktop{% endif %}"
                        data-action="doAction" data-do-action="{{ btn.action }}" data-do-command="{{ btn.command|tojson|forceescape }}">{{ btn.label }}</button>
                {% endfor %}
                <button type="button" class="btn btn-secondary hide-mobile" id="btn-fullscreen-term" data-action="openTerminalFullscreen" style="display:none">Fullscreen</button>
                {% if is_dev %}
                <div class="term-debug hide-mobile">
                    <label><input type="checkbox" id="term-debug-toggle"> Debug</label>
                    <span class="term-debug-chip" id="term-debug-readout" style="display:none">—</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Drag handle -->
        <div class="resize-handle" id="resize-handle"></div>

        <!-- Bottom tabbed panel -->
        <div class="panel bottom-tabbed">
            <div class="panel-header panel-header-flush">
                <div class="tab-group">
                    <button class="tab-btn active" id="tab-tasks-btn" role="tab" aria-selected="true" aria-controls="tab-tasks" data-action="switchTab" data-tab="tasks">
                        Tasks
                    </button>
                    <button class="tab-btn" id="tab-decisions-btn" role="tab" aria-selected="false" aria-controls="tab-decisions" data-action="switchTab" data-tab="decisions">
                        Decisions
                        <span id="proposal-badge" class="notification-badge bg-lavender" style="display:{% if proposal_count %}inline-flex{% else %}none{% endif %}">{{ proposal_count }}</span>
                    </button>
                    <button class="tab-btn" id="tab-buzz-btn" role="tab" aria-selected="false" aria-controls="tab-buzz" data-action="switchTab" data-tab="buzz">
                        Buzz Log <span id="notif-badge" class="notification-badge" style="display:none">0</span>
                    </button>
                </div>
                <span class="flex-center gap-sm">
                    <button class="btn btn-sm" data-action="showCreateTask">+ New Task</button>
                </span>
            </div>
            <!-- Tasks tab -->
            <div class="tab-content active drop-zone" id="tab-tasks" role="tabpanel" aria-labelledby="tab-tasks-btn"
                 
                 
                 
                 
                 >
                <div class="filter-bar" id="task-filters">
                    <button class="filter-chip active" data-filter="all" data-action="switchTaskFilter">All</button>
                    <button class="filter-chip" data-filter="pending" data-action="switchTaskFilter">Pending</button>
                    <button class="filter-chip" data-filter="assigned" data-action="switchTaskFilter">Active</button>
                    <button class="filter-chip" data-filter="completed" data-action="switchTaskFilter">Done</button>
                    <button class="filter-chip" data-filter="failed" data-action="switchTaskFilter">Failed</button>
                    <span class="filter-separator"></span>
                    <button class="filter-chip priority-chip active" data-priority="all" data-action="switchPriorityFilter">All</button>
                    <button class="filter-chip priority-chip" data-priority="low" data-action="switchPriorityFilter">Low</button>
                    <button class="filter-chip priority-chip" data-priority="normal" data-action="switchPriorityFilter">Normal</button>
                    <button class="filter-chip priority-chip" data-priority="high" data-action="switchPriorityFilter">High</button>
                    <button class="filter-chip priority-chip" data-priority="urgent" data-action="switchPriorityFilter">Urgent</button>
                    <input type="text" id="task-search" placeholder="Search tasks..." data-input-action="debouncedTaskSearch" class="task-search">
                </div>
                <div id="task-summary" class="task-summary">{{ task_summary }}</div>
                <div class="panel-body" id="task-list">
                    {% include "partials/task_list.html" %}
                </div>
            </div>
            <!-- Decisions tab — Queen proposals + decision history -->
            <div class="tab-content" id="tab-decisions" role="tabpanel" aria-labelledby="tab-decisions-btn">
                <!-- Queen Proposals banner -->
                <div id="proposal-banner" class="proposal-banner" style="display:{% if proposals %}block{% else %}none{% endif %};">
                    <div class="proposal-banner-header">
                        <strong class="proposal-banner-title"><img src="/static/bees/queen.svg" class="bee-icon bee-sm" alt="" style="margin-right:0.2rem">Queen Proposals (<span id="proposal-count">{{ proposal_count }}</span>)</strong>
                        <span class="flex-center gap-xs">
                            <button class="btn btn-sm btn-approve btn-proposal" data-action="approveAllProposals">Approve All</button>
                            <button class="btn btn-sm btn-reject-ghost btn-proposal" data-action="rejectAllProposals">Dismiss All</button>
                        </span>
                    </div>
                    <div id="proposal-list">
                        {% for p in proposals %}
                        <div class="proposal-item" data-proposal-id="{{ p.id }}"{% if p.proposal_type == 'completion' and p.has_source_email %} data-has-email="1"{% endif %}>
                            {% if p.proposal_type == 'escalation' %}<span class="conf-badge conf-mid">ESC</span>{% endif %}
                            <span class="proposal-worker">{{ p.worker_name }}</span>
                            {% if p.proposal_type == 'escalation' %}<span class="text-beeswax flex-1">{{ p.assessment or p.reasoning }}</span>{% else %}<span class="text-muted">&larr;</span><span class="text-beeswax flex-1">{{ p.task_title }}</span>{% endif %}
                            {% if p.reasoning and p.proposal_type != 'escalation' %}<span class="proposal-reason" title="{{ p.reasoning }}">{{ p.reasoning }}</span>{% endif %}
                            {% set conf_pct = (p.confidence * 100)|int %}<span class="conf-badge {% if conf_pct >= 70 %}conf-high{% elif conf_pct >= 40 %}conf-mid{% else %}conf-low{% endif %}">Confidence: {{ conf_pct }}%</span>
                            <span class="text-muted text-xs">{{ p.age_str }}</span>
                            <button class="btn btn-sm btn-secondary btn-log view-proposal-btn" data-proposal-id="{{ p.id }}">View</button>
                            <button class="btn btn-sm btn-approve btn-proposal" data-approve-proposal="{{ p.id }}"{% if p.proposal_type == 'completion' and p.has_source_email %} data-draft-email="1"{% endif %}>Approve</button>
                            <button class="btn btn-sm btn-reject-ghost btn-proposal" data-reject-proposal="{{ p.id }}">Dismiss</button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="panel-body" id="decisions-log">
                    <div class="empty-state"><img src="/static/bees/queen.svg" class="bee-icon bee-hero" alt=""><div class="mt-sm">No decisions yet</div></div>
                </div>
            </div>
            <!-- Buzz Log — unified activity log -->
            <div class="tab-content" id="tab-buzz" role="tabpanel" aria-labelledby="tab-buzz-btn">
                <div class="filter-bar" id="buzz-filters">
                    <button class="filter-chip active" data-buzz-cat="all" data-action="switchBuzzFilter">All</button>
                    <button class="filter-chip" data-buzz-cat="drone" data-action="switchBuzzFilter">Drone</button>
                    <button class="filter-chip" data-buzz-cat="task" data-action="switchBuzzFilter">Task</button>
                    <button class="filter-chip" data-buzz-cat="queen" data-action="switchBuzzFilter">Queen</button>
                    <button class="filter-chip" data-buzz-cat="worker" data-action="switchBuzzFilter">Worker</button>
                    <button class="filter-chip" data-buzz-cat="operator" data-action="switchBuzzFilter">Operator</button>
                    <input type="text" id="buzz-search" placeholder="Search log..." data-input-action="debouncedBuzzSearch" class="task-search">
                </div>
                <div class="panel-body" id="buzz-log"></div>
            </div>
        </div>
    </div>
</div>

<!-- Shortcut bar — keyboard shortcuts -->
<div class="shortcut-bar">
    <span><span class="sc-key">Ctrl+]</span> <span class="sc-label">Next Worker</span></span>
    <span><span class="sc-key">Ctrl+[</span> <span class="sc-label">Prev Worker</span></span>
    <span><span class="sc-key">Alt+B</span> <span class="sc-label">Drones</span></span>
    <span><span class="sc-key">Alt+A</span> <span class="sc-label">Continue All</span></span>
    <span><span class="sc-key">Alt+K</span> <span class="sc-label">Kill</span></span>
    <span><span class="sc-key">Alt+R</span> <span class="sc-label">Revive</span></span>
    <!-- Alt+T Attach removed: PTY model has no full-session view -->
    <span><span class="sc-key">Alt+Q</span> <span class="sc-label">Queen</span></span>
    <span><span class="sc-key">Alt+N</span> <span class="sc-label">New Task</span></span>
    <span><span class="sc-key">Alt+X</span> <span class="sc-label">Quit</span></span>
    <span class="shortcut-bar-version">
        <span class="sc-label" id="footer-version">v{{ version }}{% if is_dev %} <span style="color:var(--honey)">(dev)</span>{% endif %}{% if build_sha %} <span style="color:var(--muted)">@ {{ build_sha }}</span>{% endif %}</span>
        {% if is_dev %}
        <button class="btn-version-check" id="footer-reload-btn" data-action="devReload" title="Reinstall from local source and restart">Reload</button>
        <span id="footer-reload-status" style="font-size:11px;"></span>
        {% else %}
        <button class="btn-version-check" id="footer-check-update-btn" data-action="footerCheckForUpdate" title="Check for updates">Check for Updates</button>
        <span id="footer-update-status" style="font-size:11px;"></span>
        {% endif %}
    </span>
</div>

<!-- Broadcast modal (hidden) -->
<div id="broadcast-modal" class="modal-overlay" style="display:none" data-modal-dismiss="hideBroadcast">
    <div class="modal-box" role="dialog" aria-modal="true">
        <div class="panel-header">Broadcast Message</div>
        <div class="modal-padding">
            <label class="form-label">Target</label>
            <select id="broadcast-target"
                    class="modal-select mb-md">
                <option value="__all__">All Workers</option>
                {% for g in groups %}
                <option value="group:{{ g.name }}">Group: {{ g.name }}</option>
                {% endfor %}
            </select>
            <textarea id="broadcast-input" placeholder="Message to send..." rows="4"
                      class="modal-textarea"></textarea>
            <div class="modal-footer modal-footer-flush mt-md">
                <button class="btn btn-secondary" data-action="hideBroadcast">Cancel</button>
                <button class="btn" data-action="sendBroadcast">Send</button>
            </div>
        </div>
    </div>
</div>

<!-- Queen control modal (hidden) -->
<div id="queen-modal" class="modal-overlay" style="display:none" data-modal-dismiss="hideQueen">
    <div class="modal-box modal-lg" role="dialog" aria-modal="true">
        <div class="panel-header btn-queen">
            <span><img src="/static/bees/queen.svg" class="bee-icon bee-md" alt="" style="margin-right:0.3rem">Queen — Hive Conductor</span>
            <button class="btn btn-sm btn-close" data-action="hideQueen">Close</button>
        </div>
        <div id="queen-result" class="modal-body modal-body-scroll">
            <p class="text-muted">Analyzing hive...</p>
        </div>
        <div class="queen-ask-footer">
            <div class="flex-center gap-sm">
                <input type="text" id="queen-question" placeholder="Ask the Queen a question..."
                       class="modal-input flex-1"
                       data-enter-action="askQueenQuestion">
                <button class="btn btn-queen" id="queen-ask-btn" data-action="askQueenQuestion">Ask</button>
            </div>
            <div class="modal-footer modal-footer-flush">
                <button class="btn btn-secondary" data-action="askQueenRefresh" id="queen-refresh-btn">Re-analyze</button>
                <button class="btn" id="queen-apply-btn" style="display:none" data-action="applyDirectives">Apply All Directives</button>
            </div>
        </div>
    </div>
</div>
<!-- Launch modal (hidden) -->
<div id="launch-modal" class="modal-overlay" style="display:none" data-modal-dismiss="hideLaunch">
    <div class="modal-box modal-md" role="dialog" aria-modal="true">
        <div class="panel-header">
            <span><img src="/static/bees/flying-right.svg" class="bee-icon bee-md" alt="" style="margin-right:0.3rem">Launch Brood</span>
            <button class="btn btn-sm btn-secondary" data-action="hideLaunch">Close</button>
        </div>
        <div id="launch-body" class="modal-body">
            <p class="text-muted">Loading config...</p>
        </div>
        <div class="modal-footer" style="justify-content:space-between">
            <button class="btn btn-secondary btn-sm" data-action="launchAll">Launch All</button>
            <button class="btn" data-action="launchSelected">Launch Selected</button>
        </div>
    </div>
</div>
<!-- Spawn worker modal (hidden) -->
<div id="spawn-modal" class="modal-overlay" style="display:none" data-modal-dismiss="hideSpawn">
    <div class="modal-box modal-sm" role="dialog" aria-modal="true">
        <div class="panel-header">
            <span>Spawn Worker</span>
            <button class="btn btn-sm btn-secondary" data-action="hideSpawn">Close</button>
        </div>
        <div class="modal-padding">
            <label class="form-label">Worker Name</label>
            <input id="spawn-name" type="text" placeholder="e.g. worker-4"
                   class="modal-input mb-md">
            <label class="form-label">Project Path</label>
            <input id="spawn-path" type="text" placeholder="/home/user/project"
                   class="modal-input mb-sm">
            <div id="spawn-presets" class="mb-md"></div>
            <div class="modal-footer modal-footer-flush">
                <button class="btn btn-secondary" data-action="hideSpawn">Cancel</button>
                <button class="btn" data-action="doSpawn">Spawn</button>
            </div>
        </div>
    </div>
</div>
<!-- Unified Task modal — used for both Create and Edit -->
<div id="task-modal" class="modal-overlay" style="display:none" data-modal-dismiss="closeTaskModal">
    <div class="modal-box modal-xl" role="dialog" aria-modal="true">
        <div class="panel-header btn-queen" id="task-modal-header">
            <span id="task-modal-title">New Task</span>
            <button class="btn btn-sm btn-close" data-action="closeTaskModal">Close</button>
        </div>
        <div class="modal-padding">
            <label class="form-label">Description</label>
            <textarea id="tm-desc" placeholder="Paste your prompt, email, instructions..." rows="24"
                      class="modal-textarea mb-md min-h-textarea"></textarea>
            <label class="form-label">Title <span id="tm-title-hint" class="hint">(optional &mdash; auto-generated from content)</span></label>
            <input id="tm-title" type="text" placeholder="Auto-generated if blank"
                   class="modal-input mb-md">
            <div class="flex-center gap-md mb-md">
                <div>
                    <label class="form-label">Priority</label>
                    <select id="tm-priority"
                            class="modal-select">
                        <option value="normal">Normal</option>
                        <option value="low">Low</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
                <div>
                    <label class="form-label">Type</label>
                    <select id="tm-task-type"
                            class="modal-select">
                        <option value="">Auto-detect</option>
                        <option value="bug">Bug Fix</option>
                        <option value="verify">Verification</option>
                        <option value="feature">Feature</option>
                        <option value="chore">Chore</option>
                    </select>
                </div>
                <div id="tm-tags-row" class="flex-1">
                    <label class="form-label">Tags (comma-separated)</label>
                    <input id="tm-tags" type="text"
                           class="modal-input">
                </div>
            </div>
            <div class="mb-md">
                <label class="form-label">Depends on <span class="hint">(comma-separated task IDs)</span></label>
                <input id="tm-deps" type="text" placeholder="e.g. a1b2c3d4, e5f6g7h8"
                       class="modal-input">
            </div>
            <div id="tm-resolution-row" class="mb-md" style="display:none;">
                <label class="form-label label-sage">Resolution</label>
                <div id="tm-resolution" class="resolution-display"></div>
            </div>
            <label class="form-label">Attachments</label>
            <div id="tm-dropzone" class="drop-zone-dashed mb-md">
                Drop files here, paste images (Ctrl+V), or click to browse
                <input type="file" id="tm-file" class="hidden" multiple>
            </div>
            <div id="tm-attachments" class="flex-center flex-wrap gap-sm mb-md"></div>
            <div class="modal-footer modal-footer-flush">
                <button class="btn btn-secondary" data-action="closeTaskModal">Cancel</button>
                <button class="btn" id="tm-submit-btn" data-action="submitTaskModal">Create</button>
            </div>
        </div>
    </div>
</div>
<!-- Shutdown dialog modal (hidden) -->
<div id="shutdown-modal" class="modal-overlay" style="display:none" data-modal-dismiss="hideShutdown">
    <div class="modal-box modal-sm" role="dialog" aria-modal="true">
        <div class="panel-header btn-danger">
            <span>Shutdown</span>
            <button class="btn btn-sm btn-close-danger" data-action="hideShutdown">Close</button>
        </div>
        <div class="modal-body-lg">
            <p class="text-beeswax mb-lg">What would you like to do?</p>
            <div class="modal-stack">
                <button class="btn btn-secondary p-md" data-action="doRestartServer">Restart Server</button>
                <button class="btn btn-secondary p-md" data-action="doStopServer">Stop Web App</button>
                <button class="btn btn-danger p-md" data-action="doKillEverything">Kill Everything</button>
            </div>
        </div>
    </div>
</div>
<!-- Tunnel QR modal (hidden) -->
<div id="tunnel-modal" class="modal-overlay" style="display:none" data-modal-dismiss="hideTunnel">
    <div class="modal-box modal-sm" role="dialog" aria-modal="true" style="text-align:center">
        <div class="panel-header" style="background:var(--leaf);color:var(--hive-bg)">
            <span>Remote Access</span>
            <button class="btn btn-sm btn-close" data-action="hideTunnel">Close</button>
        </div>
        <div class="modal-body-lg">
            <div id="tunnel-qr" style="margin:0 auto 1rem;display:inline-block"></div>
            <p id="tunnel-url-text" class="text-beeswax mb-sm" style="word-break:break-all;font-size:0.85rem"></p>
            <div class="modal-actions-center">
                <button class="btn btn-secondary" data-action="copyTunnelUrl">Copy URL</button>
                <button class="btn btn-danger" data-action="stopTunnel">Stop Tunnel</button>
            </div>
            <p id="tunnel-warning" class="text-poppy text-xs mt-sm" style="display:none"></p>
        </div>
    </div>
</div>
<!-- Confirm modal (hidden) -->
<div id="confirm-modal" class="modal-overlay" style="display:none" data-modal-dismiss="hideConfirm">
    <div class="modal-box modal-sm" role="dialog" aria-modal="true">
        <div class="panel-header btn-danger">Confirm</div>
        <div class="modal-body-lg">
            <p id="confirm-msg" class="text-beeswax mb-lg"></p>
            <div class="modal-actions-center">
                <button class="btn btn-secondary" data-action="hideConfirm">Cancel</button>
                <button class="btn btn-danger" id="confirm-yes-btn">Confirm</button>
            </div>
        </div>
    </div>
</div>
<!-- Decision detail modal -->
<div id="decision-modal" class="modal-overlay" style="display:none" data-modal-dismiss="hideDecisionModal">
    <div class="modal-box modal-md" role="dialog" aria-modal="true">
        <div class="panel-header" id="decision-modal-header">Decision Detail</div>
        <div class="modal-padding" id="decision-modal-body"></div>
    </div>
</div>
<!-- Terminal modal (hidden) -->
<div id="terminal-modal" class="modal-overlay z-terminal" style="display:none;">
    <div class="terminal-fullscreen" role="dialog" aria-modal="true">
        <div class="panel-header no-shrink">
            <span id="terminal-title">Terminal</span>
            <span class="flex-center gap-md">
                <span id="terminal-status" class="text-sm text-muted">connecting...</span>
                <button class="btn btn-sm btn-secondary" data-action="closeTerminal">Close</button>
            </span>
        </div>
        <div id="terminal-container" class="terminal-content"></div>
    </div>
</div>
<div id="ctx-menu" class="ctx-menu" style="display:none"></div>
{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.min.css" integrity="sha384-tStR1zLfWgsiXCF3IgfB3lBa8KmBe/lG287CL9WCeKgQYcp1bjb4/+mwN6oti4Co" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.min.js" integrity="sha384-J4qzUjBl1FxyLsl/kQPQIOeINsmp17OHYXDOMpMxlKX53ZfYsL+aWHpgArvOuof9" crossorigin="anonymous" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.10.0/lib/addon-fit.min.js" integrity="sha384-XGqKrV8Jrukp1NITJbOEHwg01tNkuXr6uB6YEj69ebpYU3v7FvoGgEg23C1Gcehk" crossorigin="anonymous" defer></script>
<script src="https://cdn.jsdelivr.net/npm/@xterm/addon-clipboard@0.2.0/lib/addon-clipboard.min.js" crossorigin="anonymous" defer></script>
<script id="swarm-config" type="application/json" nonce="{{ csp_nonce }}">{"groups":{{ groups|map(attribute='name')|list|tojson }},"wsToken":{{ ws_token|tojson }},"termDebug":{{ 'true' if is_dev else 'false' }},"tunnelUrl":{{ tunnel.url|tojson }},"workerCount":{{ worker_count|tojson }}}</script>
<script src="/static/dashboard.js" nonce="{{ csp_nonce }}" defer></script>

{% endblock %}
