<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta name="theme-color" content="#2A1B0E">
    <link rel="icon" href="/static/icon-192.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/static/icon-192.png">
    <title>{% block title %}Swarm's Bee Hive{% endblock %}</title>
    <script src="https://unpkg.com/htmx.org@2.0.4" integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --honey: #D8A03D;
            --lavender: #A88FD9;
            --poppy: #D15D4C;
            --leaf: #8CB369;
            --beeswax: #E6D2B5;
            --hive-bg: #2A1B0E;
            --surface: #362415;
            --panel: #3E2B1B;
            --muted: #B0A08A;
            --border: #8C6A38;
            --amber: #D4A857;
            --error: #E74C3C;
            --sage: #8CB369;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.35), 0 2px 4px rgba(0,0,0,0.25);
            --shadow-lg: 0 8px 30px rgba(0,0,0,0.5), 0 4px 10px rgba(0,0,0,0.3);
            --shadow-glow-honey: 0 0 12px rgba(216,160,61,0.15);
            --shadow-glow-lavender: 0 0 12px rgba(168,143,217,0.15);
        }
        /* --- Visibility --- */
        .hidden { display: none; }
        @media (max-width: 768px) { .hide-mobile { display: none !important; } }
        @media (min-width: 769px) { .hide-desktop { display: none !important; } }
        /* --- Bee icons --- */
        .bee-icon { display: inline-block; vertical-align: middle; }
        .bee-xs { width: 14px; height: 14px; }
        .bee-sm { width: 18px; height: 18px; }
        .bee-md { width: 24px; height: 24px; }
        .bee-lg { width: 32px; height: 32px; }
        .bee-xl { width: 48px; height: 48px; }
        .bee-hero { width: 64px; height: 64px; }
        .toast-bee { margin-right: 0.4rem; flex-shrink: 0; }
        /* --- Inline CSS extraction: structural utilities --- */
        .min-h-textarea { min-height: 200px; }
        .min-w-field { min-width: 120px; }
        .z-terminal { z-index: 950; }
        .ws-pre-wrap { white-space: pre-wrap; }
        .placeholder-text { color: var(--muted); padding: 1rem; }
        .checkbox-leaf { accent-color: var(--leaf); }
        .opacity-half { opacity: 0.5; }
        .cursor-pointer { cursor: pointer; }
        .label-sage { color: var(--sage); }
        .conf-badge-assign { background: var(--lavender); color: var(--hive-bg); }
        .conflict-item { padding: 0.2rem 0; }
        .cb-spaced { margin-right: 0.5rem; }
        .launch-btn-gap { margin: 0.25rem 0.25rem 0 0; }
        .spawn-btn-gap { margin: 0.2rem 0.2rem 0 0; }
        .draft-label { margin: 0.5rem 0; cursor: pointer; }
        .spinner-margin { margin: 0.5rem; }
        .worker-running-badge { color: var(--leaf); font-size: 0.75rem; }
        .worker-path-text { color: var(--muted); font-size: 0.8rem; }
        .group-member-label { display: block; padding: 0.25rem 0; cursor: pointer; color: var(--beeswax); font-size: 0.85rem; }
        .launch-worker-label { display: block; padding: 0.2rem 0; }
        .status-connected { color: var(--leaf); }
        .status-muted { color: var(--muted); }
        /* --- Modal size variants --- */
        .modal-sm { max-width: 400px; }
        .modal-md { max-width: 550px; }
        .modal-lg { max-width: 650px; }
        .modal-xl { max-width: 1000px; width: 94vw; }
        /* --- Modal layout helpers --- */
        .modal-footer-flush { border-top: none; padding: 0; }
        .modal-body-scroll { max-height: 60vh; overflow-y: auto; }
        /* --- Panel variants --- */
        .panel-header-flush { gap: 0; }
        /* --- Button close variants --- */
        .btn-close { background: var(--hive-bg); color: var(--lavender); }
        .btn-close-danger { background: var(--hive-bg); color: var(--poppy); }
        /* --- Queen ask area --- */
        .queen-ask-footer {
            padding: 0.75rem; border-top: 1px solid var(--border);
            display: flex; flex-direction: column; gap: 0.5rem;
        }
        /* --- Config field widths --- */
        .field-xs { width: 100px; }
        .field-sm { max-width: 200px; }
        .field-md { width: 120px; }
        .field-caption { width: 100% !important; margin-top: 0.25rem; font-size: 0.75rem; resize: vertical; line-height: 1.4; box-sizing: border-box; }
        /* --- Resolution display --- */
        .resolution-display {
            font-size: 0.85rem; color: var(--sage);
            padding: 0.5rem 0.7rem; background: rgba(107,142,35,0.08);
            border: 1px solid var(--sage); border-radius: 4px;
            white-space: pre-wrap; max-height: 6em; overflow-y: auto;
        }
        /* --- File drop zone --- */
        .drop-zone-dashed {
            border: 2px dashed var(--border); border-radius: 6px;
            padding: 1rem; text-align: center; color: var(--muted);
            font-size: 0.85rem; cursor: pointer; transition: border-color 0.2s;
        }
        /* --- Terminal fullscreen --- */
        .terminal-fullscreen {
            width: 100vw; height: 100vh; background: var(--hive-bg);
            display: flex; flex-direction: column; overflow: hidden;
        }
        .terminal-content { flex: 1; padding: 4px; overflow: hidden; }
        /* --- Task history panel --- */
        .task-history-panel {
            padding-left: 1.5rem; border-top: 1px dashed var(--panel);
        }
        /* --- File changed banner --- */
        .file-changed-banner {
            position: fixed; bottom: 1rem; left: 50%; transform: translateX(-50%);
            background: var(--panel); border: 1px solid var(--honey); border-radius: 6px;
            padding: 0.75rem 1.5rem; z-index: 1000; align-items: center; gap: 1rem;
        }
        /* --- Text colors --- */
        .text-honey { color: var(--honey); }
        .text-muted { color: var(--muted); }
        .text-poppy { color: var(--poppy); }
        .text-leaf { color: var(--leaf); }
        .text-lavender { color: var(--lavender); }
        .text-beeswax { color: var(--beeswax); }
        .text-amber { color: var(--amber); }
        .text-sage { color: var(--sage); }
        /* --- Button variants --- */
        .btn-queen { background: var(--lavender); color: var(--hive-bg); }
        .btn-approve { background: var(--leaf); color: var(--hive-bg); }
        .btn-amber { background: var(--amber); color: var(--hive-bg); }
        /* --- Form elements --- */
        .form-label { color: var(--muted); font-size: 0.8rem; display: block; margin-bottom: 0.4rem; }
        .modal-input {
            width: 100%; background: var(--hive-bg); color: var(--beeswax);
            border: 1px solid var(--border); border-radius: 4px;
            padding: 0.4rem 0.5rem; font-family: inherit; font-size: 0.85rem;
        }
        .modal-textarea {
            width: 100%; background: var(--hive-bg); color: var(--beeswax);
            border: 1px solid var(--border); border-radius: 4px;
            padding: 0.5rem; font-family: inherit; font-size: 0.85rem; resize: vertical;
        }
        .modal-select {
            width: 100%; background: var(--hive-bg); color: var(--beeswax);
            border: 1px solid var(--border); border-radius: 4px;
            padding: 0.4rem; font-family: inherit; font-size: 0.85rem;
        }
        /* --- Layout --- */
        .modal-padding { padding: 1rem; }
        .modal-footer {
            padding: 0.75rem; border-top: 1px solid var(--border);
            display: flex; gap: 0.5rem; justify-content: flex-end;
        }
        .flex-center { display: flex; align-items: center; }
        .flex-col { display: flex; flex-direction: column; }
        .gap-xs { gap: 0.4rem; }
        .gap-sm { gap: 0.5rem; }
        .gap-md { gap: 0.75rem; }
        .gap-lg { gap: 1rem; }
        /* --- Text sizes --- */
        .text-xxs { font-size: 0.65rem; }
        .text-xs { font-size: 0.7rem; }
        .text-sm { font-size: 0.8rem; }
        .text-base { font-size: 0.85rem; }
        /* --- Layout --- */
        .flex-between { display: flex; align-items: center; justify-content: space-between; }
        .flex-wrap { flex-wrap: wrap; }
        .no-shrink { flex-shrink: 0; }
        .flex-1 { flex: 1; }
        .justify-end { justify-content: flex-end; }
        .bg-lavender { background: var(--lavender); }
        /* --- Spacing --- */
        .p-sm { padding: 0.5rem; }
        .p-md { padding: 0.75rem; }
        .px-sm { padding-left: 0.5rem; padding-right: 0.5rem; }
        .mt-sm { margin-top: 0.5rem; }
        .mb-xs { margin-bottom: 0.4rem; }
        .mb-sm { margin-bottom: 0.5rem; }
        .mb-md { margin-bottom: 0.75rem; }
        .mb-lg { margin-bottom: 1.5rem; }
        /* --- Text utilities --- */
        .no-underline { text-decoration: none; }
        .fw-bold { font-weight: bold; }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        /* --- Width --- */
        .w-input { width: 200px; }
        .w-full { width: 100%; }
        /* --- Detail header --- */
        .detail-header {
            color: var(--muted); font-size: 0.8rem; padding: 0.25rem 0.5rem;
            border-bottom: 1px solid var(--panel); margin-bottom: 0.5rem;
        }
        /* --- History --- */
        .history-empty { color: var(--muted); font-size: 0.8rem; padding: 0.5rem; }
        .history-container { padding: 0.25rem 0.5rem; }
        .history-entry {
            font-size: 0.75rem; padding: 0.15rem 0; display: flex; gap: 0.5rem;
        }
        .history-time { color: var(--muted); min-width: 120px; }
        .history-action { min-width: 70px; font-weight: bold; }
        .history-detail { color: var(--beeswax); }
        /* --- Proposals --- */
        /* --- Task list items --- */
        .task-number { font-size: 0.7rem; color: var(--muted); font-weight: bold; min-width: 2em; }
        .task-title { flex: 1; font-weight: bold; }
        .task-worker { font-size: 0.75rem; color: var(--lavender); }
        .task-age { font-size: 0.7rem; color: var(--muted); }
        .task-blocked { color: var(--poppy); font-size: 0.8rem; cursor: help; }
        .task-resolution {
            font-size: 0.8rem; color: var(--sage); padding-left: 1.5rem;
            max-height: 2.4em; overflow: hidden; text-overflow: ellipsis;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
            border-left: 2px solid var(--sage); padding: 0.2rem 0 0.2rem 0.5rem; margin-left: 1.5rem;
        }
        .task-desc-preview {
            font-size: 0.8rem; color: var(--muted); padding-left: 1.5rem;
            max-height: 2.4em; overflow: hidden; text-overflow: ellipsis;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
        }
        .task-tags { padding-left: 1.5rem; display: flex; gap: 0.3rem; }
        .task-attachments { padding-left: 1.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .task-attachment-img { max-height: 48px; max-width: 80px; border: 1px solid var(--border); border-radius: 3px; }
        .task-attachment-file {
            font-size: 0.75rem; background: var(--panel); border: 1px solid var(--border);
            border-radius: 3px; padding: 0.2rem 0.5rem; color: var(--beeswax);
            text-decoration: none; display: inline-flex; align-items: center;
            max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        }
        .btn-log { font-size: 0.65rem; padding: 0.1rem 0.3rem; }
        .btn-retry { font-size: 0.65rem; padding: 0.1rem 0.4rem; }
        .btn-remove { color: var(--poppy); padding: 0 0.3rem; }
        /* --- Queen cards (JS-generated) --- */
        @keyframes cardFadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .queen-card {
            margin-bottom: 0.75rem; padding: 1rem;
            border-radius: 8px; border: 1px solid;
            animation: cardFadeIn 0.25s ease-out;
            box-shadow: var(--shadow-md);
        }
        .queen-card-assign { background: rgba(168,143,217,0.12); border-color: var(--lavender); box-shadow: var(--shadow-md), inset 0 0 20px rgba(168,143,217,0.06); }
        .queen-card-complete { background: rgba(124,170,90,0.12); border-color: var(--leaf); box-shadow: var(--shadow-md), inset 0 0 20px rgba(140,179,105,0.06); }
        .queen-card-escalation { background: rgba(209,93,76,0.12); border-color: var(--amber); box-shadow: var(--shadow-md), inset 0 0 20px rgba(212,168,87,0.06); }
        .queen-card-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; }
        /* Bold one-line summary at top of each queen card */
        .queen-summary {
            font-size: 0.95rem; font-weight: bold; color: var(--beeswax);
            padding: 0.4rem 0; line-height: 1.3;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            margin-bottom: 0.75rem;
        }
        /* Capped text width for Assessment/Reasoning paragraphs */
        .queen-text-block { max-width: 540px; line-height: 1.5; }
        .queen-card-assessment { padding: 0.75rem; background: var(--panel); border-radius: 4px; margin-bottom: 1rem; }
        .queen-code-block {
            padding: 0.5rem; background: var(--panel); border: 1px solid var(--border);
            border-radius: 4px; font-family: monospace; font-size: 0.8rem;
            white-space: pre-wrap; max-height: 8rem; overflow-y: auto;
        }
        .directive-row {
            display: flex; align-items: center; gap: 0.5rem;
            padding: 0.4rem 0.5rem; border-bottom: 1px solid var(--panel);
        }
        .directive-worker { color: var(--lavender); font-weight: bold; min-width: 80px; }
        .directive-action { min-width: 90px; }
        .directive-detail { flex: 1; font-size: 0.8rem; color: var(--muted); }
        /* Queen recommends callout */
        .queen-recommends-callout {
            display: flex; align-items: center; gap: 0.5rem;
            padding: 0.5rem 0.75rem; margin-bottom: 0.75rem;
            background: rgba(168,143,217,0.1);
            border-left: 3px solid var(--lavender);
            border-radius: 0 4px 4px 0;
        }
        .conflicts-card {
            margin-top: 1rem; padding: 0.75rem;
            background: rgba(209,93,76,0.15); border: 1px solid var(--poppy); border-radius: 4px;
        }
        .resolution-block {
            margin-bottom: 0.5rem; padding: 0.5rem;
            background: rgba(124,170,90,0.08); border-radius: 4px;
        }
        /* --- Queen notification banners (non-blocking, replace modal popups) --- */
        #queen-notifications {
            position: fixed; top: 56px; left: 0; right: 0; z-index: 900;
            display: flex; flex-direction: column; align-items: center;
            pointer-events: none;
            padding-top: 0.5rem;
        }
        .queen-banner {
            pointer-events: auto;
            display: flex; align-items: center; gap: 0.75rem;
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.35rem;
            border-radius: 6px;
            border-left: 4px solid;
            background: var(--panel);
            box-shadow: var(--shadow-md);
            max-width: 700px; width: 90%;
            animation: bannerSlideIn 0.25s ease-out;
            font-size: 0.82rem;
        }
        .queen-banner-esc { border-left-color: var(--amber); background: #3a2e1a; }
        .queen-banner-done { border-left-color: var(--leaf); background: #2a331e; }
        .queen-banner-badge {
            font-size: 0.65rem; padding: 0.15rem 0.45rem; border-radius: 8px;
            font-weight: bold; white-space: nowrap; flex-shrink: 0;
        }
        .queen-banner-badge-esc { background: var(--amber); color: var(--hive-bg); }
        .queen-banner-badge-done { background: var(--leaf); color: var(--hive-bg); }
        .queen-banner-body { flex: 1; min-width: 0; }
        .queen-banner-worker { font-weight: bold; color: var(--lavender); }
        .queen-banner-assessment { color: var(--muted); margin-left: 0.25rem; }
        .queen-banner-actions { display: flex; gap: 0.35rem; flex-shrink: 0; }
        .queen-banner-actions .btn { font-size: 0.72rem; padding: 0.2rem 0.5rem; }
        @keyframes bannerSlideIn {
            from { opacity: 0; transform: translateY(-1rem); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* --- Dashboard header --- */
        .header-clock { color: var(--muted); font-size: 0.8rem; font-weight: normal; margin-left: 0.75rem; }
        .header-icon { height: 1.4em; vertical-align: middle; margin-right: 0.3rem; }
        .btn-notif { font-size: 0.9rem; padding: 0.4rem 0.6rem; }
        /* --- Tab groups --- */
        .tab-group { display: flex; gap: 0; }
        /* --- Proposal banner --- */
        .proposal-banner {
            background: rgba(168,143,217,0.1); border: 1px solid var(--lavender);
            border-radius: 4px; margin: 0.5rem; padding: 0.5rem 0.75rem;
            box-shadow: var(--shadow-sm), var(--shadow-glow-lavender);
        }
        .proposal-banner-header {
            display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.4rem;
        }
        .proposal-banner-title { color: var(--lavender); font-size: 0.85rem; }
        .proposal-item {
            display: flex; align-items: center; gap: 0.5rem;
            padding: 0.3rem 0; border-top: 1px solid rgba(168,143,217,0.2); font-size: 0.8rem;
        }
        .proposal-worker { color: var(--lavender); font-weight: bold; min-width: 100px; }
        .proposal-reason { color: var(--muted); font-size: 0.75rem; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .btn-proposal { font-size: 0.7rem; padding: 0.15rem 0.5rem; }
        .decision-entry {
            display: flex; align-items: center; gap: 0.5rem;
            padding: 0.3rem 0.5rem; border-top: 1px solid rgba(168,143,217,0.15); font-size: 0.8rem;
            cursor: pointer;
        }
        .decision-entry:hover { background: rgba(168,143,217,0.1); box-shadow: inset 3px 0 0 var(--lavender); }
        .decision-time { min-width: 70px; }
        .decision-detail-row { margin-bottom: 0.6rem; }
        .decision-detail-label { font-size: 0.75rem; color: var(--muted); margin-bottom: 0.15rem; }
        .decision-detail-value { color: var(--beeswax); font-size: 0.85rem; line-height: 1.4; }
        /* --- Filter / search --- */
        .filter-separator { border-left: 1px solid var(--border); margin: 0 0.2rem; }
        .task-search {
            margin-left: 0.5rem; background: var(--panel); border: 1px solid var(--border);
            color: var(--beeswax); padding: 0.2rem 0.5rem; border-radius: 4px;
            font-size: 0.75rem; width: 150px;
        }
        .task-summary { font-size: 0.75rem; color: var(--muted); padding: 0.2rem 0.75rem; }
        /* --- Drop zone --- */
        .drop-zone { transition: border-color 0.2s; border: 2px solid transparent; }
        /* --- Modal utilities --- */
        .modal-body { padding: 1rem; }
        .modal-body-lg { padding: 1.5rem; text-align: center; }
        .modal-actions { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
        .modal-actions-center { display: flex; gap: 0.5rem; justify-content: center; }
        .modal-stack { display: flex; flex-direction: column; gap: 0.75rem; }
        /* --- Config input widths --- */
        .w-input-lg { width: 320px; }
        .w-select-sm { width: 110px; }
        .w-select-md { width: 120px; }
        .w-select-sm-2 { width: 80px; }
        /* --- Launch / spawn preset buttons --- */
        .launch-label { color: var(--muted); font-size: 0.8rem; }
        .launch-scroll { max-height: 300px; overflow-y: auto; }
        /* --- Config page utilities --- */
        .config-max-w { max-width: 800px; }
        .flex-1 { flex: 1; }
        .text-upper { text-transform: uppercase; }
        /* --- Config table --- */
        .rule-table { width: 100%; font-size: 0.78rem; border-collapse: collapse; }
        .rule-table th, .rule-table td { padding: 0.3rem 0.5rem; }
        .rule-table thead tr { border-bottom: 1px solid var(--border); color: var(--muted); text-align: left; }
        .rule-table tbody { color: var(--beeswax); }
        .rule-table tbody tr { border-bottom: 1px solid var(--panel); }
        /* --- Confidence / type badges --- */
        .conf-badge { font-size: 0.65rem; padding: 0.1rem 0.45rem; border-radius: 8px; font-weight: bold; }
        .conf-high { background: var(--leaf); color: var(--hive-bg); }
        .conf-mid { background: var(--amber); color: var(--hive-bg); }
        .conf-low { background: var(--error); color: #fff; }
        .type-badge { font-size: 0.65rem; padding: 0.1rem 0.5rem; border-radius: 8px; font-weight: bold; color: #fff; }
        .type-bug { background: var(--poppy); }
        .type-feature { background: var(--lavender); }
        .type-verify { background: var(--leaf); }
        .type-chore { background: var(--muted); }
        .type-tag { background: var(--panel); color: var(--beeswax); border: 1px solid var(--border); }
        /* --- Helper text --- */
        .help-text { font-size: 0.75rem; color: var(--muted); margin-bottom: 0.5rem; }
        .hint { font-size: 0.7rem; color: var(--muted); font-weight: normal; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            background: var(--hive-bg);
            color: var(--beeswax);
            min-height: 100vh;
        }
        header {
            background: var(--surface);
            border-bottom: 2px solid var(--honey);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            position: relative;
            z-index: 10;
        }
        header h1 { color: var(--honey); font-size: 1.2rem; }
        header .status { color: var(--muted); font-size: 0.85rem; }
        .ws-indicator {
            display: inline-block;
            width: 8px; height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
            background: var(--poppy);
            transition: background 0.3s;
        }
        .ws-indicator.connected { background: var(--leaf); }
        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: 1fr;
            gap: 1rem;
            padding: 1rem;
            height: calc(100vh - 56px - 28px);
        }
        .shortcut-bar {
            background: var(--panel);
            border-top: 1px solid var(--border);
            padding: 0.25rem 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            font-size: 0.75rem;
            height: 28px;
            flex-shrink: 0;
            box-shadow: 0 -2px 6px rgba(0,0,0,0.3);
            position: relative;
            z-index: 5;
        }
        .shortcut-bar .sc-key {
            color: var(--honey);
            font-weight: bold;
        }
        .shortcut-bar .sc-label {
            color: var(--muted);
        }
        .shortcut-bar-version {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }
        .btn-version-check {
            background: transparent;
            color: var(--muted);
            border: 1px solid var(--border);
            border-radius: 3px;
            padding: 1px 6px;
            font-size: 11px;
            cursor: pointer;
            line-height: 1.4;
        }
        .btn-version-check:hover {
            color: var(--honey);
            border-color: var(--honey);
        }
        .panel {
            background: var(--surface);
            border: 1px solid rgba(140,106,56,0.6);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-sm);
        }
        .panel-header {
            background: var(--panel);
            color: var(--honey);
            font-weight: bold;
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .panel-body {
            padding: 0.5rem;
            overflow-y: auto;
            flex: 1;
        }

        /* Worker list */
        .worker-list { }
        .worker-item {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--panel);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.15s, box-shadow 0.15s;
        }
        .worker-item:hover { background: var(--panel); box-shadow: inset 3px 0 0 var(--honey); }
        .worker-item.selected { background: rgba(168,143,217,0.2); color: var(--text); box-shadow: inset 3px 0 0 var(--lavender); }
        .worker-item.selected .worker-meta { color: var(--muted); }
        .worker-item.selected .worker-task { color: var(--lavender); }
        .state-dot {
            width: 10px; height: 10px;
            border-radius: 50%;
            display: inline-block;
            flex-shrink: 0;
        }
        .state-dot-sm { width: 8px; height: 8px; }
        .state-BUZZING { background: var(--leaf); animation: pulse-glow 2s ease-in-out infinite; }
        .state-WAITING { background: var(--honey); animation: pulse-glow-waiting 3s ease-in-out infinite; }
        .state-RESTING { background: var(--lavender); }
        .state-SLEEPING { background: var(--muted); }
        .worker-item[data-state="SLEEPING"] { opacity: 0.45; }
        .state-STUNG { background: var(--poppy); animation: pulse-glow-stung 1.5s ease-in-out infinite; }
        .worker-name { font-weight: bold; }
        .worker-meta { font-size: 0.75rem; color: var(--muted); }
        .worker-task { font-size: 0.7rem; color: var(--lavender); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 160px; }

        /* Detail panel */
        .detail-area {
            display: grid;
            grid-template-rows: 1fr auto 1fr;
            gap: 0;
            min-height: 0;
        }
        .detail-area > .panel {
            min-height: 0;
            overflow: hidden;
        }
        .detail-area > .panel > .panel-body {
            overflow-y: auto;
        }

        /* Resize handle */
        .resize-handle {
            height: 6px;
            cursor: row-resize;
            background: transparent;
            position: relative;
            flex-shrink: 0;
        }
        .resize-handle::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 4px;
            border-radius: 2px;
            background: var(--border);
            transition: background 0.15s, width 0.15s;
        }
        .resize-handle:hover::after,
        .resize-handle.dragging::after {
            background: var(--honey);
            width: 60px;
        }
        .worker-output {
            background: var(--hive-bg);
            padding: 0.5rem;
            font-size: 0.8rem;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-y: auto;
            border: 1px solid var(--panel);
            border-radius: 6px;
        }

        /* Bottom tabbed panel */
        .bottom-tabbed {
            min-height: 0;
            overflow: hidden;
        }
        .bottom-tabbed > .tab-content {
            display: none;
            min-height: 0;
            flex: 1;
            overflow: hidden;
        }
        .bottom-tabbed > .tab-content.active {
            display: flex;
            flex-direction: column;
        }
        .bottom-tabbed > .tab-content > .panel-body {
            overflow-y: auto;
            flex: 1;
        }
        .tab-btn {
            background: transparent;
            border: none;
            color: var(--muted);
            font-family: inherit;
            font-weight: bold;
            font-size: 0.85rem;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: color 0.15s, border-color 0.15s;
        }
        .tab-btn:hover { color: var(--beeswax); }
        .tab-btn.active { color: var(--honey); border-bottom-color: var(--honey); text-shadow: 0 0 8px rgba(216,160,61,0.3); }

        /* Task board */
        .task-item {
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--panel);
            font-size: 0.85rem;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 0.25rem;
        }
        .task-item:hover { background: rgba(216,160,61,0.04); }
        .task-status { color: var(--muted); }
        .task-priority-urgent { color: var(--poppy); font-weight: bold; }
        .task-priority-high { color: var(--poppy); }
        .task-priority-low { color: var(--muted); font-style: italic; }

        /* Drone / system log */
        .drones-entry, .drone-entry { padding: 0.2rem 0.5rem; font-size: 0.8rem; }
        .drone-continued { color: var(--honey); }
        .drone-revived { color: var(--lavender); }
        .drone-escalated { color: var(--poppy); font-weight: bold; }
        .drone-operator { color: var(--leaf); }
        .drone-approved { color: var(--leaf); font-weight: bold; }
        .drone-rejected { color: var(--honey); }
        .drone-task_created, .drone-task_assigned, .drone-task_completed { color: var(--leaf); }
        .drone-task_failed, .drone-task_send_failed { color: var(--poppy); font-weight: bold; }
        .drone-task_removed { color: var(--muted); }
        .drone-queen_proposal, .drone-queen_auto_acted { color: var(--lavender); }
        .drone-queen_escalation { color: var(--poppy); }
        .drone-queen_completion { color: var(--lavender); }
        .drone-worker_stung { color: var(--poppy); font-weight: bold; }
        .drone-draft_ok { color: var(--leaf); }
        .drone-draft_failed { color: var(--poppy); }
        .drone-config_changed { color: var(--muted); }
        .category-badge { font-size: 0.6rem; padding: 0.05rem 0.3rem; border-radius: 8px; font-weight: bold; text-transform: uppercase; margin-right: 0.25rem; }
        .category-drone { background: var(--honey); color: var(--hive-bg); }
        .category-task { background: var(--leaf); color: var(--hive-bg); }
        .category-queen { background: var(--lavender); color: var(--hive-bg); }
        .category-worker { background: var(--poppy); color: #fff; }
        .category-system { background: var(--muted); color: var(--hive-bg); }
        .category-operator { background: #5BA3B5; color: var(--hive-bg); }

        .btn {
            background: var(--honey);
            color: var(--hive-bg);
            border: none;
            padding: 0.4rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            font-size: 0.85rem;
        }
        .btn:hover { opacity: 0.92; box-shadow: 0 1px 4px rgba(0,0,0,0.25); }
        .btn:active { transform: translateY(0.5px); box-shadow: none; }
        .btn-approve:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(140,179,105,0.4); }
        .btn-approve:active { transform: translateY(0); box-shadow: none; }
        .btn-queen:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(168,143,217,0.4); }
        .btn-queen:active { transform: translateY(0); box-shadow: none; }
        .btn-secondary { background: var(--panel); color: var(--beeswax); border: 1px solid var(--border); }
        /* Ghost-style Reject button — less visual weight than Approve */
        .btn-reject-ghost { background: transparent; color: var(--muted); border: none; opacity: 0.8; }
        .btn-reject-ghost:hover { color: var(--poppy); text-decoration: underline; opacity: 1; }
        .btn-danger { background: var(--poppy); color: white; }
        .btn-active { background: var(--leaf); color: var(--hive-bg); }
        .action-bar {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-top: 1px solid var(--border);
            flex-wrap: wrap;
            box-shadow: 0 -1px 4px rgba(0,0,0,0.15);
        }

        /* Mobile send bar — visible text input for touch devices */
        .mobile-send-bar {
            display: none;
            gap: 0.4rem;
            padding: 0.3rem 0.5rem;
            border-top: 1px solid var(--border);
            background: var(--surface);
        }
        .mobile-send-bar input {
            flex: 1;
            background: var(--hive-bg);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.4rem 0.6rem;
            font-size: 0.85rem;
            font-family: inherit;
        }
        .mobile-send-bar input:focus {
            outline: none;
            border-color: var(--honey);
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 60px;
            right: 1rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .toast {
            background: var(--panel);
            border: 1px solid var(--honey);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 3s forwards;
            max-width: 350px;
            box-shadow: var(--shadow-md);
        }
        .toast.toast-warning { border-color: var(--poppy); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(-10px); } }

        /* Small button variant */
        .btn-sm { padding: 0.2rem 0.5rem; font-size: 0.75rem; }

        /* Modal overlay */
        @keyframes overlayFadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes modalScale { from { transform: scale(0.97); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 900;
            align-items: center;
            justify-content: center;
            animation: overlayFadeIn 0.2s ease-out;
        }
        .modal-box {
            background: var(--surface);
            border: 1px solid rgba(216,160,61,0.6);
            border-radius: 10px;
            min-width: 400px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalScale 0.2s ease-out;
            box-shadow: var(--shadow-lg), var(--shadow-glow-honey);
        }

        /* Input focus */
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--honey) !important; box-shadow: 0 0 0 2px rgba(216,160,61,0.2); }

        /* Config page */
        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            padding: 1rem;
            height: calc(100vh - 56px);
            overflow-y: auto;
        }
        .config-section { margin-bottom: 1rem; }
        .config-section h3 {
            color: var(--honey);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            padding-bottom: 0.3rem;
            border-bottom: 1px solid var(--border);
        }
        .config-field {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.4rem 0;
            gap: 0.5rem;
        }
        .config-field label {
            font-size: 0.85rem;
            color: var(--beeswax);
            flex-shrink: 0;
        }
        .config-input {
            background: var(--hive-bg);
            color: var(--beeswax);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.3rem 0.5rem;
            font-family: inherit;
            font-size: 0.85rem;
            width: 120px;
            text-align: right;
        }
        textarea.config-input { text-align: left; }
        .config-input.text-left { text-align: left; }
        .toggle-switch {
            position: relative;
            width: 40px;
            height: 22px;
            flex-shrink: 0;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute;
            inset: 0;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 11px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            left: 2px;
            bottom: 2px;
            background: var(--muted);
            border-radius: 50%;
            transition: transform 0.2s, background 0.2s;
        }
        .toggle-switch input:checked + .toggle-slider { background: var(--honey); border-color: var(--honey); }
        .toggle-switch input:checked + .toggle-slider::before { transform: translateX(18px); background: var(--hive-bg); }
        .restart-badge {
            font-size: 0.7rem;
            color: var(--honey);
            background: rgba(216,160,61,0.15);
            border: 1px solid var(--honey);
            border-radius: 3px;
            padding: 0.1rem 0.4rem;
            margin-left: 0.3rem;
        }
        .worker-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 0.4rem 0.5rem;
            border-bottom: 1px solid var(--panel);
            font-size: 0.85rem;
            gap: 0.75rem;
        }
        .worker-grid {
            display: grid;
            grid-template-columns: minmax(100px, 1fr) minmax(120px, 1.5fr) minmax(140px, 2fr) 90px 70px;
            gap: 0.4rem 0.6rem;
            align-items: center;
            padding: 0.35rem 0.5rem;
            border-bottom: 1px solid var(--panel);
            font-size: 0.82rem;
        }
        .worker-grid-header {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: var(--muted);
            padding-bottom: 0.25rem;
            border-bottom: 1px solid var(--border);
        }
        .worker-grid-name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .worker-grid-path {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 0.78rem;
        }
        .worker-grid-desc {
            width: 100%;
            box-sizing: border-box;
            font-size: 0.78rem;
        }
        .worker-grid-provider {
            width: 100%;
            box-sizing: border-box;
        }
        .worker-grid-add {
            padding: 0.5rem;
            border-bottom: none;
        }
        @media (max-width: 700px) {
            .worker-grid {
                grid-template-columns: 1fr 1fr;
                gap: 0.3rem;
            }
            .worker-grid-header { display: none; }
            .worker-grid-path { grid-column: 1 / -1; }
            .worker-grid-desc { grid-column: 1 / -1; }
        }
        .group-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.4rem 0.5rem;
            border-bottom: 1px solid var(--panel);
            font-size: 0.85rem;
        }
        .config-add-form {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem 0;
            flex-wrap: wrap;
            align-items: center;
        }
        .config-add-form input, .config-add-form select {
            background: var(--hive-bg);
            color: var(--beeswax);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.3rem 0.5rem;
            font-family: inherit;
            font-size: 0.85rem;
        }

        /* Config tabs */
        .config-tab { max-width: 1100px; }
        .config-tab-nav {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }
        .approval-rule-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.4rem;
        }
        .approval-rule-row input { flex: 1; }
        .approval-rule-row select { width: 110px; }
        #task-buttons-list .task-btn-label { flex: 0 0 160px; }
        /* Drag-and-drop reorder */
        .drag-handle {
            cursor: grab;
            color: var(--muted);
            font-size: 1.1rem;
            user-select: none;
            padding: 0 2px;
            line-height: 1;
        }
        .drag-handle:active { cursor: grabbing; }
        .approval-rule-row.dragging { opacity: 0.4; }
        .approval-rule-row.drag-over { border-top: 2px solid var(--honey); margin-top: -2px; }
        /* Visibility toggle pills (M/D) */
        .vis-pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 26px;
            height: 22px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--muted);
            transition: all 0.15s;
            flex-shrink: 0;
        }
        .vis-pill:hover { border-color: var(--honey); }
        .vis-pill.active { background: var(--leaf); color: #1a1a0e; border-color: var(--leaf); }
        .vis-pill input { display: none; }
        .confidence-display {
            font-size: 0.85rem;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        /* Config page — unsaved banner */
        .unsaved-banner {
            background: rgba(216,160,61,0.15);
            border-bottom: 2px solid var(--honey);
            padding: 0.4rem 1.5rem;
            text-align: center;
            font-size: 0.85rem;
            color: var(--honey);
        }
        /* Config page — vertical field layout */
        .config-field-col {
            flex-direction: column;
            align-items: stretch;
        }
        /* Config page — section footer (add form area) */
        .config-section-footer {
            padding: 0.5rem 0.75rem;
            border-top: 1px solid var(--border);
        }
        /* Config page — setup guide */
        .setup-guide { margin-bottom: 1rem; font-size: 0.8rem; color: var(--beeswax); }
        .setup-guide summary { cursor: pointer; color: var(--honey); font-weight: bold; margin-bottom: 0.5rem; }
        .setup-guide-body { padding: 0.75rem; border-left: 2px solid var(--border); margin-top: 0.25rem; }
        .setup-guide-body p { margin: 0 0 0.5rem; color: var(--muted); font-size: 0.78rem; }
        .setup-step { margin: 0 0 0.25rem; font-weight: bold; }
        .setup-guide-body ol { margin: 0 0 0.75rem; padding-left: 1.25rem; line-height: 1.9; }
        .setup-callout {
            margin: 0.5rem 0 0;
            padding: 0.5rem 0.6rem;
            border-radius: 3px;
            background: rgba(216,160,61,0.1);
            font-size: 0.75rem;
            color: var(--honey);
        }
        /* Config page — log viewer */
        .log-output {
            background: var(--hive-bg);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 0.75rem;
            font-size: 0.75rem;
            color: var(--beeswax);
            max-height: 70vh;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            min-height: 200px;
        }
        /* Config page — system prompt textarea */
        .textarea-prompt {
            width: 100%;
            min-height: 600px;
            resize: vertical;
            font-size: 0.8rem;
        }
        /* Config page — graph status box */
        .status-box {
            margin-bottom: 1rem;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            border: 1px solid var(--border);
            font-size: 0.85rem;
        }
        /* Config page — group edit modal body */
        .group-edit-body { padding: 1rem; }
        .group-edit-body label { display: block; font-size: 0.8rem; color: var(--muted); margin-bottom: 0.25rem; }
        /* Utility: margin overrides */
        .mb-0 { margin-bottom: 0; }
        .mb-xs { margin-bottom: 0.25rem; }
        .mt-xs { margin-top: 0.25rem; }
        .mt-sm { margin-top: 0.4rem; }
        .mt-md { margin-top: 0.75rem; }
        .ml-xs { margin-left: 0.5rem; }
        .ml-auto { margin-left: auto; }
        /* Inline terminal (worker detail panel) */
        #inline-terminal { width: 100%; height: 100%; }
        #inline-terminal .xterm { height: 100%; }
        #inline-terminal .xterm-viewport { overflow-y: hidden !important; }

        /* Spinner animation */
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(140,179,105,0.4); }
            50% { box-shadow: 0 0 6px 3px rgba(140,179,105,0.25); }
        }
        @keyframes pulse-glow-stung {
            0%, 100% { box-shadow: 0 0 0 0 rgba(209,93,76,0.4); }
            50% { box-shadow: 0 0 6px 3px rgba(209,93,76,0.3); }
        }
        @keyframes pulse-glow-waiting {
            0%, 100% { box-shadow: 0 0 0 0 rgba(216,160,61,0.4); }
            50% { box-shadow: 0 0 5px 2px rgba(216,160,61,0.2); }
        }
        @keyframes gentle-bob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }
        .spinner {
            display: inline-block;
            width: 16px; height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--honey);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
            margin-right: 0.4rem;
        }
        .update-spinner {
            display: inline-block;
            width: 12px; height: 12px;
            border: 2px solid var(--border);
            border-top-color: var(--leaf);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
            margin-right: 0.3rem;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--muted);
            font-size: 0.85rem;
        }
        .empty-state-icon { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .empty-state .bee-icon { animation: gentle-bob 3s ease-in-out infinite; }

        /* Revive badge */
        .revive-badge {
            font-size: 0.65rem;
            color: var(--poppy);
            background: rgba(209,93,76,0.15);
            border: 1px solid var(--poppy);
            border-radius: 3px;
            padding: 0.05rem 0.3rem;
            margin-left: 0.3rem;
            font-weight: bold;
        }

        /* Worker groups */
        .group-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.75rem;
            cursor: pointer;
            background: var(--panel);
            border-bottom: 1px solid var(--border);
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--honey);
            user-select: none;
        }
        .group-header:hover { background: rgba(216,160,61,0.1); box-shadow: inset 3px 0 0 var(--honey); }
        .group-chevron {
            display: inline-block;
            transition: transform 0.2s;
            font-size: 0.7rem;
        }
        .group-collapsed .group-chevron { transform: rotate(-90deg); }
        .group-collapsed .worker-item { display: none; }
        .group-count {
            font-size: 0.7rem;
            font-weight: normal;
            color: var(--muted);
            margin-left: auto;
        }

        /* Filter chips (task filters) */
        .filter-bar {
            display: flex;
            gap: 0.3rem;
            padding: 0.3rem 0.5rem;
            border-bottom: 1px solid var(--panel);
            flex-wrap: wrap;
        }
        .filter-chip {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--muted);
            font-family: inherit;
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .filter-chip:hover { color: var(--beeswax); border-color: var(--beeswax); box-shadow: 0 0 4px rgba(230,210,181,0.15); }
        .filter-chip.active { background: var(--honey); color: var(--hive-bg); border-color: var(--honey); box-shadow: 0 0 6px rgba(216,160,61,0.25); }

        /* Notification badge */
        .notification-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 16px;
            height: 16px;
            font-size: 0.6rem;
            font-weight: bold;
            background: var(--poppy);
            color: white;
            border-radius: 8px;
            padding: 0 4px;
            margin-left: 0.3rem;
            vertical-align: middle;
            box-shadow: 0 0 6px rgba(209,93,76,0.3);
        }
        .notification-entry {
            padding: 0.3rem 0.5rem;
            border-bottom: 1px solid var(--panel);
            font-size: 0.8rem;
            display: flex;
            gap: 0.5rem;
        }
        .notification-entry .notif-time {
            color: var(--muted);
            font-size: 0.7rem;
            flex-shrink: 0;
            min-width: 60px;
        }
        .notification-entry.notif-warning { color: var(--poppy); }

        /* HTMX loading indicator */
        .htmx-indicator { display: none; }
        .htmx-request .htmx-indicator { display: inline-block; }
        .htmx-request .htmx-content { opacity: 0.5; }

        /* Task item selected worker highlight */
        .task-item.assigned-to-selected {
            border-left: 3px solid var(--lavender);
            padding-left: calc(0.75rem - 3px);
        }

        /* --- Responsive: Tablet (768px) --- */
        /* --- Mobile overflow menu --- */
        .mobile-overflow { display: none; position: relative; }
        .mobile-overflow-btn {
            background: var(--panel); color: var(--beeswax); border: 1px solid var(--border);
            border-radius: 6px; padding: 0.4rem 0.6rem; font-size: 1rem; cursor: pointer;
            font-family: inherit; font-weight: bold; line-height: 1;
        }
        .mobile-overflow-menu {
            display: none; position: absolute; top: 100%; right: 0; margin-top: 0.25rem;
            background: var(--surface); border: 1px solid var(--border); border-radius: 8px;
            min-width: 160px; z-index: 100; box-shadow: var(--shadow-lg);
            padding: 0.25rem 0; flex-direction: column;
        }
        .mobile-overflow-menu.open { display: flex; }
        .mobile-overflow-menu .btn {
            border-radius: 0; text-align: left; justify-content: flex-start;
            width: 100%; font-size: 0.8rem; padding: 0.5rem 0.75rem;
        }
        .mobile-overflow-menu .btn:first-child { border-radius: 8px 8px 0 0; }
        .mobile-overflow-menu .btn:last-child { border-radius: 0 0 8px 8px; }

        @media (max-width: 768px) {
            /* Dashboard: single column, full viewport */
            .dashboard {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                height: calc(100vh - 56px);
                padding: 0.5rem;
                gap: 0.5rem;
            }

            /* Header: compact two-row layout */
            header {
                padding: 0.5rem 0.75rem;
                flex-wrap: wrap;
                gap: 0.4rem;
            }
            header h1 { font-size: 1rem; }
            header .status { font-size: 0.75rem; }
            /* Hide non-essential header buttons, show overflow menu */
            .header-hide-mobile { display: none !important; }
            .mobile-overflow { display: inline-block; }

            /* Worker list: compact horizontal pill strip */
            .worker-list {
                max-height: none;
                border-radius: 6px;
            }
            .worker-list > .panel-header { display: none; }
            .worker-list > .panel-body {
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                overflow-y: hidden;
                gap: 0.3rem;
                padding: 0.3rem;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }
            .worker-list > .panel-body::-webkit-scrollbar { display: none; }
            /* Flatten group wrappers so children join the flex row */
            .group-section { display: contents; }
            .worker-item {
                flex-shrink: 0;
                border-bottom: none;
                border-radius: 16px;
                padding: 0.25rem 0.6rem;
                border: 1px solid var(--panel);
                font-size: 0.8rem;
                gap: 0.3rem;
            }
            .worker-item .worker-meta { display: none; }
            .worker-item .worker-task { display: none; }
            .worker-item.selected { border-color: var(--lavender); background: rgba(168,143,217,0.2); }
            .group-header {
                flex-shrink: 0;
                border-bottom: none;
                border-radius: 16px;
                padding: 0.2rem 0.5rem;
                font-size: 0.7rem;
            }
            .group-chevron { display: none; }
            .group-collapsed .worker-item { display: flex; }
            .group-count { display: none; }
            .worker-list > .action-bar { display: none; }

            /* Detail area: no hard cap so JS resize handle works */
            .detail-area {
                grid-template-rows: 1fr auto 1fr;
                min-height: 0;
            }

            /* Action bar: horizontal scroll instead of wrapping */
            .action-bar {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                padding: 0.3rem 0.5rem;
            }
            .action-bar::-webkit-scrollbar { display: none; }
            .action-bar .btn {
                flex-shrink: 0;
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
            }

            /* Filter bars: horizontal scroll */
            .filter-bar {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }
            .filter-bar::-webkit-scrollbar { display: none; }
            .filter-chip { flex-shrink: 0; }

            /* Tab buttons: compact */
            .tab-btn { font-size: 0.8rem; padding: 0.4rem 0.7rem; }

            /* Modals: full-width on mobile */
            .modal-box {
                min-width: unset !important;
                width: min(95vw, 450px);
            }

            /* Config page */
            .config-grid { grid-template-columns: 1fr; }

            /* Hide shortcut bar */
            .shortcut-bar { display: none; }

            /* Task search: full width */
            .task-search { width: 100px; min-width: 80px; flex-shrink: 1; }

            /* Proposals: compact */
            .proposal-item { flex-wrap: wrap; gap: 0.3rem; }
            .proposal-reason { max-width: 100%; }
            .proposal-worker { min-width: auto; }

            /* Bottom panel: taller on mobile — scrolling is fine */
            .bottom-tabbed { min-height: 40vh; }
        }

        /* --- Responsive: Phone (480px) --- */
        @media (max-width: 480px) {
            header { padding: 0.4rem 0.5rem; gap: 0.3rem; }
            header h1 { font-size: 0.9rem; }
            header > div { gap: 0.3rem; }
            header .btn { font-size: 0.7rem; padding: 0.25rem 0.5rem; }
            .dashboard { padding: 0.25rem; gap: 0.25rem; }
            .worker-item {
                padding: 0.2rem 0.5rem;
                font-size: 0.75rem;
            }
            .worker-name { font-size: 0.75rem; }
            .detail-area {
                grid-template-rows: 1fr auto 1fr;
            }
            .tab-btn { font-size: 0.7rem; padding: 0.35rem 0.5rem; }
            .filter-chip { font-size: 0.65rem; padding: 0.15rem 0.4rem; }
            .drone-entry { font-size: 0.7rem; padding: 0.15rem 0.3rem; }
            .task-item { padding: 0.3rem 0.5rem; font-size: 0.8rem; }
        }

        /* Fullscreen terminal overlay (mobile scroll mode) */
        .terminal-fullscreen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #2A1B0E;
            display: flex;
            flex-direction: column;
            height: 100vh;   /* fallback for older browsers */
            height: 100dvh;  /* dynamic viewport height — accounts for mobile address bar */
        }
        .terminal-fullscreen-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.4rem 0.8rem;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .terminal-fullscreen-bar .fs-title {
            color: var(--text);
            font-size: 0.85rem;
            font-weight: 600;
        }
        .terminal-fullscreen-bar .btn-close-fs {
            background: none;
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            padding: 0.3rem 0.8rem;
            font-size: 0.85rem;
            cursor: pointer;
        }
        .terminal-fullscreen-body {
            flex: 1;
            overflow: hidden;
            touch-action: none;
        }

        /* Touch-friendly targets */
        @media (pointer: coarse) {
            .worker-item { min-height: 40px; }
            .btn { min-height: 36px; }
            .tab-btn { min-height: 40px; }
            /* Show mobile send bar on touch devices */
            .mobile-send-bar.visible { display: flex; }
            .filter-chip { min-height: 32px; padding: 0.25rem 0.6rem; }
            .resize-handle { height: 12px; }
        }

        /* Window Controls Overlay — PWA title bar */
        @media (display-mode: window-controls-overlay) {
            header {
                app-region: drag;
                -webkit-app-region: drag;
                padding-left: calc(env(titlebar-area-x, 0px) + env(titlebar-area-width, 0px) + 0.75rem);
                padding-top: env(titlebar-area-y, 0px);
                min-height: env(titlebar-area-height, auto);
            }
            header button, header a, header select, header input {
                app-region: no-drag;
                -webkit-app-region: no-drag;
            }
        }
    </style>
</head>
<body>
    <div class="toast-container" id="toasts"></div>
    {% block body %}{% endblock %}
    {% block scripts %}{% endblock %}
    <script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(function() {});
    }
    </script>
</body>
</html>
